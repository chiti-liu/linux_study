## 网络设备

### 概念

#### OSI

七层：物理层、数据链路层、网络层、传输层、会话层、表示层、应用层

#### TCP/IP

四层：网络访问层（Network Access） 互联网络层（Internet）

​			主机到主机（Host To Host ）  	应用层（Application）

### 操作方法

#### init

​	alloc_etherdev

​		ether_setup

​		//指定struct net_device_ops并做net_device的相关指定

​		netdev_priv	//指定skb方便后面找到并释放

​			register_netdev

#### net_device_ops.open

​	netif_start_queue	//启动发送队列，允许上层发送数据包

net_device_ops.net_tx	//启动发送数据包

​	//获取发送包的缓冲区起始地址和数据包的长度，如果数据包的长度小于以太网允许的最短数据包的长度，则对数据包进行填充以满足最小长度

​	//记录发送时间和skb结构指针（方便发送完后释放）

​		net_hw_tx	//真正发送数据包

net_hw_tx

​	//依旧是数据包长度的判断

​		//取出源IP地址和目标IP地址，然后将最后一个字节交换

​			//指定接受数据包的网络设备

​				send_packet//发送数据

//数据包发送完后释放skb，在中断处理函数中进一步调用tx_done函数。

### skb

skb有数据包长度要求，必须大于最短数据包长度

- head	skb头部，以太网协议包头一般是14个字节，但是一般需要skb_reverse来让数据头以16字节对齐
- data     数据包内容
- tail        数据包结尾
- end	  skb结尾

#### skb_reverse

参数：skb,len

data和tail向end方向偏移len个字节	

#### skb_put

tail向end方向偏移len个字节

一般就用这个来放数据

#### skb_push

data向head方向偏移len个字节

#### skb_pull	

data向end方向偏移len个字节

### 测试命令

#### ethtool

```
https://www.cnblogs.com/zhongguiyao/p/13942778.html
```

#### ifconfig

#### ping 

#### route

#### gateway 