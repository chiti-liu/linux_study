## 智慧树......哦不，设备树

```
https://blog.csdn.net/thisway_diy/article/details/84336817
```

设备树意义：

1. 平台识别
2. 实时配置
3. 设备植入

- dts：作为设备树源码，一般一个硬件包含1个dts文件。
- dtsi：可以作为共性部分，以C语言的特性包含在dts文件中，或者配置某些硬件的“okay”**使能**
- dtc：设备树编译工具，把dts文件编译成dtb文件。
- dtb：设备树二进制文件，可以反编译

因为会涉及到很多硬件信息的绑定，详细的可以查阅 Linux 内核源码下的文档`Documentation/devicetree/bindings`。

根节点以/{}开头，一个设备文件中只有一个，并且所有的设备文件最后都会组成一个根节点。

```
aliases{
uart0=&uart_0};取别名，以后用spi_0作为标签访问。

uart_0  :  uart@360000{  				//标签：节点@设备地址 
	compatible = "firefly,rk3399","forlinx,rk3399" //决定绑定在哪个设备，在前有优先权。
	#address-cells = <1>; 	//表示用一个32位的数来描述地址
	#size-cells = <1>;		//表示用1个32位的数来描述该地址的大小
	//正确解释一个reg属性需要用到前面两个属性，
	ranges = <0 0x360000 0x1000>;	//子地址 父地址 子地址空间区域大小 
	reg = <0x360000 0x1000>;//理解为基地址+偏移地址
	interrupt-parent = <&gic>;
	
	ch34x0:ch34x@370000{
		compatible:"****";
		reg = <0x370000 0x1000>;
		interrupts = <GIC_SPI 62 IRQ_TYPE_LEVEL_HIGH>;
		/**SPI为0，共享的外设中断；62为中断号；第三个参数为中断触发类型。
		*中断类型为;0：SPI共享外设中断，可以连接到一个SOC的多个ARM核;1:PPI:私有外设中断（即只能连接到一个特定的ARM核）
		**/
		
	};
};
```

```
gic:interrupt-controller@1094000{
	compatible = "****";
	#interrupt-cells = <3>;//决定cells描述有几个
	interrupt-controller;//定义一个接受中断的节点，即中断控制器。
};
```

```
chosen{
	bootargs = "console=ttysWK,9600";
};//并不是一个真的设备，只是为固件和操作系统传递参数的地方，如引导参数。
```

```
#address-cells = <1>;//表示用一个32位的数来描述地址

#size-cells = <0>;//表示用0个32位的数来描述该地址的大小

上面两个信息#address-cells和#size-cells主要用来描述子节点里面reg的信息

reg里面的个数，应该是address-cells + size-cells的整数倍
```

 
